<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸´ê¸‰ ëŒ€í”¼ ê²½ë¡œ</title>
    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=322ea1257890550e201bc03ce603c57d&libraries=services"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background-color: #f8f9fa;
            color: #343a40;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(0, 122, 255, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(0, 122, 255, 0.2);
        }

        .header h1 {
            font-size: 2.2em;
            color: #007AFF;
            margin-bottom: 10px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
            font-weight: 500;
            margin-bottom: 0;
            line-height: 1.4;
        }

        .header p strong {
            color: #007AFF;
            font-weight: 600;
        }

        .emergency-info {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
            font-size: 1em;
            color: #555;
        }

        .emergency-info span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        #map {
            width: 100%;
            height: 500px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid #e9ecef;
        }

        .info-window {
            padding: 10px 16px;
            font-size: 15px;
            color: #343a40;
            background: white;
            border-radius: 8px;
            font-weight: 600;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid #e9ecef;
        }

        #goBtn {
            display: none;
            width: 100%;
            padding: 18px 20px;
            font-size: 1.3em;
            color: white;
            background-color: #007AFF;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            transition: all 0.3s;
            margin-top: 20px;
            box-shadow: 0 4px 10px rgba(0, 122, 255, 0.2);
            font-weight: 700;
        }

        #goBtn:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
        }

        .status {
            margin-top: 20px;
            padding: 18px;
            background: white;
            border-radius: 8px;
            font-size: 1.1em;
            color: #666;
            border: 1px solid #e9ecef;
            font-weight: 500;
        }

        .emergency-alert {
            background: #007AFF;
            color: white;
            padding: 14px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1.1em;
            box-shadow: 0 4px 10px rgba(0, 122, 255, 0.2);
            letter-spacing: -0.3px;
        }

        .emergency-alert span {
            margin-right: 12px;
            font-size: 1.2em;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        #goBtn {
            animation: pulse 2s infinite;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .header h1 {
                font-size: 2em;
            }
            #map {
                height: 50vh;
            }
            #goBtn {
                font-size: 1.2em;
                padding: 16px 20px;
            }
            .emergency-alert {
                font-size: 1em;
                padding: 14px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš¨ ê¸´ê¸‰ ëŒ€í”¼ ê²½ë¡œ</h1>
            <p><strong id="disaster-location">ì„œìš¸ì‹œ ê°•ë‚¨êµ¬</strong>ì—ì„œ <strong id="disaster-type">ì§€ì§„</strong>ì´ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤.<br></p>
            <div class="emergency-info">
                <span>ğŸ•’ <span id="current-time">--:--</span></span>
                <span>ğŸ“ í˜„ ìœ„ì¹˜ì™€ì˜ ê±°ë¦¬: <span id="disaster-distance">3.7km</span></span>
            </div>
        </div>
        <div class="emergency-alert">
            <span>âš¡ í˜„ì¬ ìœ„ì¹˜ì—ì„œ ì•ˆì „í•œ ëŒ€í”¼ì†Œê¹Œì§€ ê²½ë¡œë¥¼ ì•ˆë‚´í•©ë‹ˆë‹¤</span>
        </div>
        <div id="map"></div>
        <a id="goBtn" href="#" target="_blank">
            ğŸš¶â€â™‚ï¸ ì•ˆì „í•œ ëŒ€í”¼ ê²½ë¡œ ì•ˆë‚´ ë°›ê¸°
        </a>
        <div class="status">
            âœ¨ ì‘ê¸‰ìƒí™©ì€ 119 ë˜ëŠ” 112ë¡œ ì‹ ê³  ë°”ëë‹ˆë‹¤.
        </div>
    </div>

    <script>
        // Disaster information variables
        const disasterInfo = {
            location: 'ì„œìš¸ì‹œ ê°•ë‚¨êµ¬',
            type: 'ì§€ì§„',
            scale: 'ê·œëª¨ 3.5',
            time: '14:23',
            distance: '3.7km',
            coordinates: {  // ì¬ë‚œ ë°œìƒ ìœ„ì¹˜ ì¢Œí‘œ
                lat: 37.498095,
                lng: 127.027610
            },
            radius: 5000  // ìœ„í—˜ ë°˜ê²½ (ë¯¸í„° ë‹¨ìœ„)
        };

        // Update disaster information
        document.getElementById('disaster-location').textContent = disasterInfo.location;
        document.getElementById('disaster-type').textContent = disasterInfo.type;
        document.getElementById('disaster-distance').textContent = disasterInfo.distance;

        // Add current time update function
        function updateCurrentTime() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('current-time').textContent = `${hours}:${minutes}`;
        }
        
        // Update time immediately and every minute
        updateCurrentTime();
        setInterval(updateCurrentTime, 60000);

        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                const lat = position.coords.latitude;
                const lng = position.coords.longitude;
                const locPosition = new kakao.maps.LatLng(lat, lng);

                const mapContainer = document.getElementById('map');
                const mapOption = {
                    center: locPosition,
                    level: 7  // ì§€ë„ ë ˆë²¨ì„ ì¡°ê¸ˆ ë†’ì—¬ì„œ ë” ë„“ì€ ì˜ì—­ í‘œì‹œ
                };

                const map = new kakao.maps.Map(mapContainer, mapOption);

                // í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤
                const marker = new kakao.maps.Marker({
                    position: locPosition,
                    map: map
                });

                const iwContent = '<div class="info-window">ğŸ“ í˜„ì¬ ìœ„ì¹˜</div>';
                const customOverlay = new kakao.maps.CustomOverlay({
                    position: locPosition,
                    content: iwContent,
                    yAnchor: 1.5
                });
                customOverlay.setMap(map);

                // ì¬ë‚œ ë°œìƒ ìœ„ì¹˜ ë§ˆì»¤
                const disasterPosition = new kakao.maps.LatLng(disasterInfo.coordinates.lat, disasterInfo.coordinates.lng);
                const disasterMarker = new kakao.maps.Marker({
                    position: disasterPosition,
                    map: map
                });

                // ì¬ë‚œ ìœ„ì¹˜ ì •ë³´ì°½
                const disasterOverlay = new kakao.maps.CustomOverlay({
                    position: disasterPosition,
                    content: '<div class="info-window" style="background: rgba(255, 59, 48, 0.1); border-color: rgba(255, 59, 48, 0.5);">âš ï¸ ì¬ë‚œ ë°œìƒ ì§€ì </div>',
                    yAnchor: 1.5
                });
                disasterOverlay.setMap(map);

                // ìœ„í—˜ ë°˜ê²½ ì› ê·¸ë¦¬ê¸°
                const circle = new kakao.maps.Circle({
                    center: disasterPosition,
                    radius: disasterInfo.radius,
                    strokeWeight: 1,
                    strokeColor: '#FF3B30',
                    strokeOpacity: 0.7,
                    strokeStyle: 'solid',
                    fillColor: '#FF3B30',
                    fillOpacity: 0.15
                });
                circle.setMap(map);

                // ì§€ë„ ë²”ìœ„ë¥¼ ì¬ì„¤ì •í•˜ì—¬ ëª¨ë“  ë§ˆì»¤ê°€ ë³´ì´ë„ë¡ í•¨
                const bounds = new kakao.maps.LatLngBounds();
                bounds.extend(locPosition);
                bounds.extend(disasterPosition);
                map.setBounds(bounds);

                const ps = new kakao.maps.services.Places();
                const keyword = "ì‹œì¥";

                ps.keywordSearch(keyword, function(data, status) {
                    if (status === kakao.maps.services.Status.OK) {
                        const nearest = data[0];
                        const destLat = nearest.y;
                        const destLng = nearest.x;
                        const destName = nearest.place_name;

                        const shelterPos = new kakao.maps.LatLng(destLat, destLng);
                        const shelterMarker = new kakao.maps.Marker({
                            position: shelterPos,
                            map: map
                        });

                        const shelterOverlay = new kakao.maps.CustomOverlay({
                            position: shelterPos,
                            content: `<div class="info-window">${destName} ğŸ¥</div>`,
                            yAnchor: 1.5
                        });
                        shelterOverlay.setMap(map);

                        // 2ì´ˆ í›„ì— í˜„ì¬ ìœ„ì¹˜ì™€ ëŒ€í”¼ì†Œ ì¤‘ì‹¬ìœ¼ë¡œ ì§€ë„ ì¬ì¡°ì •
                        setTimeout(() => {
                            // í˜„ì¬ ìœ„ì¹˜ì™€ ëŒ€í”¼ì†Œë§Œì„ ê¸°ì¤€ìœ¼ë¡œ ê²½ê³„ ì„¤ì •
                            const routeBounds = new kakao.maps.LatLngBounds();
                            routeBounds.extend(locPosition);
                            routeBounds.extend(shelterPos);
                            
                            // ì—¬ìœ  ê³µê°„ì„ ìœ„í•´ ì˜ì—­ í™•ì¥
                            const padding = 100; // í”½ì…€ ë‹¨ìœ„ì˜ ì—¬ìœ  ê³µê°„
                            map.setBounds(routeBounds, padding);

                            // í˜„ì¬ ìœ„ì¹˜ì™€ ëŒ€í”¼ì†Œì˜ ì¤‘ê°„ ì§€ì ì„ ê³„ì‚°
                            const centerLat = (locPosition.getLat() + shelterPos.getLat()) / 2;
                            const centerLng = (locPosition.getLng() + shelterPos.getLng()) / 2;
                            const centerPosition = new kakao.maps.LatLng(centerLat, centerLng);
                            
                            // ë¶€ë“œëŸ¬ìš´ íŒ¨ë‹ìœ¼ë¡œ ì´ë™
                            map.panTo(centerPosition);

                            // ìƒíƒœ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
                            document.querySelector('.status').textContent = 
                                'âœ¨ ê°€ì¥ ê°€ê¹Œìš´ ëŒ€í”¼ì†Œê¹Œì§€ì˜ ì•ˆì „í•œ ê²½ë¡œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.';
                        }, 2000);  // 2ì´ˆë¡œ ë³€ê²½

                        const btn = document.getElementById("goBtn");
                        const mapUrl = new URL('https://map.kakao.com/');
                        mapUrl.searchParams.append('target', 'walk');
                        mapUrl.searchParams.append('sName', 'ë‚´ìœ„ì¹˜');
                        mapUrl.searchParams.append('sx', lat);
                        mapUrl.searchParams.append('sy', lng);
                        mapUrl.searchParams.append('eName', destName);
                        mapUrl.searchParams.append('ex', destLat);
                        mapUrl.searchParams.append('ey', destLng);
                        btn.href = mapUrl.toString();
                        btn.style.display = "block";
                    } else {
                        alert("ê²€ìƒ‰ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                    }
                }, {
                    location: locPosition,
                    radius: 10000
                });

            }, function(error) {
                alert('ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ìœ„ì¹˜ ì ‘ê·¼ ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
            });
        } else {
            alert('ì´ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
        }
    </script>
</body>
</html> 